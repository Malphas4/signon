<% content_for :title, "Granting permissions to all users" %>

<% if @bulk_grant_permission_set.in_progress? %>
  <% content_for(:head) do %>
    <meta http-equiv="refresh" content="3">
  <% end %>
<% end %>

<% if @bulk_grant_permission_set.in_progress? %>
  <%= render "govuk_publishing_components/components/notice", {
    title: "In progress. #{@bulk_grant_permission_set.processed_users} of #{@bulk_grant_permission_set.total_users} users processed."
    } %>
<% elsif @bulk_grant_permission_set.successful? %>
  <%= render "govuk_publishing_components/components/success_alert", {
    message: "All #{@bulk_grant_permission_set.processed_users} users processed."
    } %>
<% else %>
  <%= render "govuk_publishing_components/components/error_alert", {
    message: "Only #{@bulk_grant_permission_set.processed_users} of #{@bulk_grant_permission_set.total_users} users processed."
    } %>
<% end %>

<%= render "govuk_publishing_components/components/table", {
  head: [
    { text: "Application" },
    { text: "Has access to?" },
    { text: "Other Permissions" },
  ],
  rows: bulk_grant_permissions_by_application(@bulk_grant_permission_set).map { |(application, permissions)|
    formatted_row(application, permissions)
  },
} %>
